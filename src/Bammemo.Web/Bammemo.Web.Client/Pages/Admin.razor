@page "/admin"
@using Bammemo.Service.Abstractions.Paginations
@rendermode InteractiveWebAssembly
@inject ICommonSlipService commonSlipService

<PageTitle>Admin 123</PageTitle>

<FluentGrid Justify="JustifyContent.Center">
    <FluentGridItem xs="12" lg="8" xl="6">
        <FluentStack Orientation="Orientation.Vertical">

            <Bammemo.Web.Client.Layout.SlipEditor />

            @foreach (var s in slipList)
            {
                <Bammemo.Web.Client.Layout.SlipCard Data="s" @key="s.Id" />
            }

            <div>
                <FluentButton OnClick="LoadMore">Load more</FluentButton>
            </div>

        </FluentStack>
    </FluentGridItem>

    <FluentGridItem lg="3" HiddenWhen="GridItemHidden.MdAndDown">
        <div>asdfasdf</div>
        <div>asdfasdf</div>
        <div>asdfasdf</div>
        <div>asdfasdf</div>
    </FluentGridItem>
</FluentGrid>


@code {

    private List<ListSlipDto> slipList = new List<ListSlipDto>();
    string? cursorSlipId = null;

    protected override async Task OnInitializedAsync()
    {
        var slips = await commonSlipService.ListAsync(null);

        RenderSlips(slips);
    }

    private void RenderSlips(ListSlipDto[] slips)
    {
        if (slips.Length > 0)
        {
            slipList.AddRange(slips);
            cursorSlipId = slips.Last().Id;
        }
    }

    private async Task LoadMore()
    {
        var slips = await commonSlipService.ListAsync(new CursorPagingRequest<string>
            {
                Cursor = cursorSlipId,
                Take = 5
            });

        RenderSlips(slips);
    }
}